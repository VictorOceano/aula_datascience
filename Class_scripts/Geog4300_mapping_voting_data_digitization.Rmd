---
title: "Digitization race"
output:
  github_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(googlesheets)
gs_auth(token = "C:/Users/jshannon/Dropbox/Jschool/Teaching/Courses/Geog4300_6300 Fall 17/geog4300/googlesheets_token.rds")
```

## Digitizing the election data--mapping our work

The googlesheets package provides an easy way to import data from Google Sheets. Let's pull in the list of folks who did the work of digitizing. First, we'll load the right packages

```{r, message=FALSE, warning=FALSE}
library(tidyverse)
library(googlesheets)
library(sf)
```

Then we'll load the data. You generally can only do this with sheets that you "own," but if you know the key of a public document you can access it that way. [http://www.coolheadtech.com/blog/use-data-from-other-google-spreadsheets] (Here's a link) to how to find that key. They key for our voting document is listed below. There's then a command to extract just the first five columns of the first tab.

```{r}
sheet<-gs_key("1pr4d0LDWJcIJEfMLB2DEe9m3ruuBlZcb6NLUnRIP-kM")

gs_ws_ls(sheet) #Tab names

results<-sheet %>% 
  gs_read("Overview") %>%
  select(1:5)

head(results) #Look at the first few rows
```

From here, we can simply tally votes by each person.

```{r}
tally_signout<-results %>%
  group_by(Signout) %>%
  summarise(signout_count=sum(Districts_1992)+sum(Districts_2016)) %>%
  rename("Name"=Signout)

tally_verified<-results %>%
  group_by(Verified) %>%
  summarise(verified_count=sum(Districts_1992)+sum(Districts_2016)) %>%
  rename("Name"=Verified)

tally_all<-left_join(tally_signout,tally_verified) %>%
  mutate(total_count<-signout_count+verified_count)

tally_all
```

Visualize the results as bar graph.

```{r}
tally_all_long<-gather(tally_all,signout_count:verified_count,key="var",value="count")

ggplot(tally_all_long,aes(x=reorder(Name,-count),y=count,fill=var)) +
  geom_bar(stat="identity") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

Lastly, we can join our count data to a state shapefile.

```{r}
states<-st_read("https://github.com/jshannon75/geog4300/raw/master/Data/USstates.geojson") %>%
  rename("State"=STATE_NAME) %>%
  st_transform(5070)
statecount<-left_join(states,results)h
```

Here's our map of those who entered data:
```{r}
library(tmap)

tm_shape(statecount)+
  tm_polygons("Signout")+
  tm_layout(legend.outside=TRUE)
```

Here's the map of those who verified that data:
```{r}
tm_shape(statecount)+
  tm_polygons("Verified")+
  tm_layout(legend.outside=TRUE)
```